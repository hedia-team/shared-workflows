# Documentation: https://hedia.atlassian.net/wiki/spaces/DT/pages/2118811649/npm+packages+-+workflow+alpha+auto-publishing
name: Publish release version of package on npm

on:
  # Should be called when a PR is merged into master.
  workflow_call:
    secrets:
      NPM_TOKEN:
        required: true
      GITHUB_PAT:
        required: true

permissions:
  pull-requests: read

env:
  ENV_FILE: .env

jobs:
  publish-release-package:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
        with:
          token: ${{ secrets.GITHUB_PAT }}

      - name: Load .env file
        run: cat ${{ env.ENV_FILE }} >> $GITHUB_ENV

      - name: Publish release version of package on npm
        uses: hedia-team/autobump-and-publish@master
        with:
          github-token: ${{ secrets.GITHUB_PAT }}
          npm-token: ${{ secrets.NPM_TOKEN }}
          node-version: ${{ env.NODE_VERSION }}
          issue-number: ${{ github.event.number }}
          is-post-merge: 'true'
